{% extends "base.html" %}

{% block content %}
<div class="page-header v-h">
    <h1>Add Order</h1>
    <a href="{{ url_for('order_list') }}" class="btn btn-secondary">Back</a>
</div>

<div class="form-container">
    <form method="POST" class="order-form" enctype="multipart/form-data">
<div class="t1">
    <div>
        <div>
            {% if user and user.logo_data %}
                <img src="{{ url_for('get_user_logo', user_id=user.id) }}" width=168px height="83px" alt="Company Logo">
            {% else %}
                <img src="{{ url_for('static', filename='logo.png') }}" width=168px height="83px" alt="Company Logo">
            {% endif %}
        </div>
        <div class="t2"><div><b>PESANAN</b>No：TP</div><div style="border-bottom: 1px solid #666;"><input type="text" id="no" name="no" class="inps"></div></div></div>
    <div><table class="tb2">
        <tr><td>Name：</td><td class="vvc"><input type="text" id="nama" name="nama" class="inps"></td><td></td><td class="nos">Terima Tgl：</td><td class="vvc"><input type="date" id="terima_tgl" name="terima_tgl" value="{{current_date}}" class="inps"></td></tr>
        <tr><td>Telpon：</td><td class="vvc"><input type="text" id="telpon" name="telpon" class="inps"></td><td></td><td class="nos">Selesal Tgl：</td><td class="vvc"><input type="date" id="selesal_tgl" name="selesal_tgl" value="{{current_date}}" class="inps"></td></tr>
        <tr><td>Alamat：</td><td colspan="4" class="vvc"><input type="text" name="alamat" class="inps"></td></tr>
        <tr><td colspan="5">
            {% if user and user.address %}
                {{ user.address|safe }}
                {% if user and user.tel %}Tel. {{ user.tel }}{% endif %}
                {% if user and user.fac %}Fac. {{ user.fac }}{% endif %}
            {% else %}
                Plaza TunjunganIVLt2Unit211-212JJendral Basuki Rachmad 2-12.Surabaya-Indonesia
                {% if user and user.tel %}Tel. {{ user.tel }}{% else %}Tel. +6231 5472647{% endif %}
                {% if user and user.fac %}Fac. {{ user.fac }}{% else %}Fac. +6231 5474057{% endif %}
            {% endif %}
        </td></tr>
        </table>
    </div>
</div>


<table class="tb3">
    <tr><td>KODE/GAMBAR</td><td colspan="2">BRAM/KARAT/INSTRUKSI</td></tr>
    <tr><td rowspan="10" width=300px >
                <div class="image-upload-area" id="uploadArea">
                    <p class="upload-hint">Picture</p>
                    <input type="file" id="image" name="image" accept="image/*"
                           style="display: none;" onchange="previewImage(this, 'preview')">
                </div>
                <div id="preview" class="image-preview" style="display: none;">
                    <img src="" alt="Preview" onclick="replaceImage()" style="width: 300px;height: 210px" />
                </div>
            </td>
        <td colspan="2"><input type="text" name="bram_karat1" class="inps"></td></tr>
    <tr><td colspan="2"><input type="text" name="bram_karat2" class="inps"></td></tr>
    <tr><td colspan="2"><input type="text" name="bram_karat3" class="inps"></td></tr>
    <tr><td colspan="2"><input type="text" name="bram_karat4" class="inps"></td></tr>
    <tr><td colspan="2"><input type="text" name="bram_karat5" class="inps"></td></tr>
    <tr><td colspan="2"><input type="text" name="bram_karat6" class="inps"></td></tr>
    <tr><td colspan="2"><input type="text" name="bram_karat7" class="inps"></td></tr>
    <tr><td colspan="2"><input type="text" name="bram_karat8" class="inps"></td></tr>
    <tr><td colspan="2"><input type="text" name="bram_karat9" class="inps"></td></tr>
    <tr><td colspan="2"><input type="text" name="bram_karat10" class="inps"></td></tr>
    <tr><td colspan="3" style="border:none"></td></tr>
    <tr><td>TOKO</td><td>SPL/QC</td><td>PESANAN TIBA/ DIKIRIM TANGGAL</td></tr>
    <tr><td style="height: 50px"><textarea class="result1" name="toko"></textarea></td><td><textarea class="result1" name="spl_qc"></textarea></td><td><input type="date" id="selesal_tgl" name="pesanan_tiba_dikirim_tanggal" value="{{current_date}}" class="inps"></td></tr>
</table>
      

        
        <div class="form-actions v-h">
            <button type="submit" class="btn btn-primary">Save Order</button>
            <a href="{{ url_for('order_list') }}" class="btn btn-secondary">Cancel</a><a onclick="javascript:window.print();" class="btn btn-secondary">Print</a>
        </div>
    </form>
</div>

<script>
const uploadArea = document.getElementById('uploadArea');
const fileInput = document.getElementById('image');

uploadArea.addEventListener('click', () => {
    fileInput.click();
});

uploadArea.addEventListener('dragover', (e) => {
    e.preventDefault();
    uploadArea.classList.add('dragover');
});

uploadArea.addEventListener('dragleave', () => {
    uploadArea.classList.remove('dragover');
});

uploadArea.addEventListener('drop', (e) => {
    e.preventDefault();
    uploadArea.classList.remove('dragover');

    const files = e.dataTransfer.files;
    if (files.length > 0 && files[0].type.startsWith('image/')) {
        fileInput.files = files;
        previewImage(fileInput, 'preview');
    }
});

function previewImage(input, previewId) {
    const preview = document.getElementById(previewId);
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
            preview.querySelector('img').src = e.target.result;
            preview.style.display = 'block';
            uploadArea.style.display = 'none';
        }
        reader.readAsDataURL(input.files[0]);
    } else {
        preview.style.display = 'none';
        uploadArea.style.display = 'block';
    }
}

function replaceImage() {
    fileInput.click();
}

function removeImage() {
    fileInput.value = '';
    document.getElementById('preview').style.display = 'none';
    uploadArea.style.display = 'block';
}
</script>
{% endblock %}
